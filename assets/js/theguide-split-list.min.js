angular.module("tgSplitList",["tgToggle","tgUtils","ingGlobal"]),angular.module("tgSplitList").directive("tgSplitFocusElement",["ingKeyBinderConfig",function(a){return{restrict:"A",priority:0,require:["^tgSplitList","?^tgSplitMoreItem","?^tgSplitItem","tgSplitFocusElement","?^^tgToggle","?^^tgSplitListB"],controller:function(){},link:function(b,c,d,e){var f=e[2],g=e[1],h=e[5],i=e[4],j=e[0],k=g?g:f,l=a.specialKeys();if(!f&&!g)throw new Error("Please define where the tg-split-focus-element is part of (place 'tg-split-item' or 'tg-split-more-item' on its parent).");b.$on("splitList.init",function(){k.registerFocusFunction(function(){c[0].focus()}),k.registerFocusableEnabler(function(){c.attr("tabindex","0")}),k.registerFocusableDisabler(function(){c.attr("tabindex","-1")})}),f&&j.config.delegateFocus&&c.on("click",function(){c[0].focus(),j.handleFocus("self")}),f&&h?(c.on("keyup",function(a){a.which===l.enter&&(j.handleFocus("close","afterList"),i.close())}),c.on("click",function(){j.handleFocus("close","afterList"),i.close()})):g&&c.on("click",function(){j.handleFocus("toggle")})}}}]),angular.module("tgSplitList").controller("SplitItemController",["$scope","$element","tgUtils",function(a,b,c){var d=this;this.api={hide:function(){b.css("display","none")},show:function(){b.css("display","")},getClientWidth:function(){return b[0].clientWidth},getOuterWidth:function(){return c.outerWidth(b)},setClientWidth:function(a){b.css("width",a?a+"px":"")},isActiveElement:function(){return b[0]===document.activeElement||b[0].contains(document.activeElement)},focus:function(){},enableFocusable:function(){},disableFocusable:function(){}},this.registerFocusFunction=function(a){d.api.focus=a},this.registerFocusableEnabler=function(a){d.api.enableFocusable=a},this.registerFocusableDisabler=function(a){d.api.disableFocusable=a}}]),angular.module("tgSplitList").directive("tgSplitItem",[function(){return{restrict:"A",priority:1,scope:!0,require:["^tgSplitList","tgSplitItem","?^tgSplitListA","?^tgSplitListB"],link:function(a,b,c,d){var e=d[0],f=d[1],g=d[2],h=d[3];if(!g&&!h)throw new Error("Please define which list('a' or 'b') the current item is part of (place 'tg-split-list-a' or 'tg-split-list-b' directive on its parent)");a.$on("splitList.init",function(){e.addItem(f.api,h?"b":"a")})},controller:"SplitItemController"}}]),angular.module("tgSplitList").directive("tgSplitMoreItem",[function(){return{restrict:"A",priority:1,scope:!0,require:["^tgSplitList","tgSplitMoreItem"],link:function(a,b,c,d){var e=d[0],f=d[1];a.$on("splitList.init",function(){e.addMoreBtn(f.api)})},controller:"SplitItemController"}}]),angular.module("tgSplitList").directive("tgSplitListA",[function(){return{restrict:"A",require:"^tgSplitList",controller:function(){}}}]),angular.module("tgSplitList").directive("tgSplitListB",[function(){return{restrict:"A",require:["^tgSplitList","^tgToggle"],link:function(a,b,c,d){var e=d[0],f=d[1];f.config.srOnly=!0,e.dropdownCtrl=f},controller:function(){}}}]),angular.module("tgSplitList").directive("tgSplitList",[function(){return{restrict:"A",scope:!0,controllerAs:"splitList",link:function(a,b,c,d){function e(){for(var b in d.config){var e=a.$eval(c[b]);angular.isDefined(e)&&(d.config[b]=e)}}e(),d._init()},controller:["$element","$timeout","$scope","$attrs","$document","$window","mqService","ingKeyBinderConfig",function(a,b,c,d,e,f,g,h){function i(a){a.which===l.tab&&(k._updateFocusedIndex(),k.state._moreVisible=k.state.startIndexB>-1&&k.state._focusedIndex>=k.state.startIndexB,k.dropdownCtrl[k.state._moreVisible?"open":"close"]())}function j(a){a.which===l.escape&&k.handleFocus("close","afterList")}var k=this,l=h.specialKeys();this.config={syncList:!1,justify:!1,delegateFocus:!0,availableWidthFn:function(){}},this._data={listA:[],listB:[],moreBtn:{}},this.state={startIndexB:-1,_focusedIndex:-1,_moreVisible:!1,_childRegistrationComplete:!1},this._init=function(){k.config.syncList?c.$watch(function(){return c.$eval(d.list)},k._initList,!0):k._initList(),k._addSkipLink()},this._initList=function(){k.state._childRegistrationComplete=!1,k.A=k.B=c.$eval(d.list),b(function(){k._data.listA=[],k._data.listB=[],k._data.moreBtn={},c.$broadcast("splitList.init"),k.state._childRegistrationComplete=!0,k._setAccessibilityButtons(),k._splitList()})},this._setAccessibilityButtons=function(){for(var a in k._data.listA)k._data.listA[a].enableFocusable(),k._data.listB[a].enableFocusable();k._data.moreBtn.disableFocusable()},this._addSkipLink=function(){a.append('<a tabindex="-1" id="splitListSkip-'+c.$id+'"></a>')},this._splitList=function(){if(k.state._childRegistrationComplete){var b,c=k._data.listA,d=k._data.moreBtn,e=c.length;for(a.css("visibility","hidden"),b=0;e>b;b++)k.config.justify&&c[b].setClientWidth(""),c[b].show();d.show(),k.config.justify&&d.setClientWidth(""),a[0].style.display="none",a[0].offsetHeight,a[0].style.display="";var f=k.config.availableWidthFn()||a[0].clientWidth,g=d.getOuterWidth(),h=0,i=0,j=0,l=0;for(b=0;e>b;b++)h+=c[b].getOuterWidth(),k.config.justify&&(l+=c[b].getOuterWidth()-c[b].getClientWidth()),f-g>=h?(i++,j++):f>=h&&j++;var m=j===e;if(k.config.justify&&!m&&(l+=d.getOuterWidth()-d.getClientWidth()),k.state.startIndexB=m?-1:i,k.state._moreVisible=m?!1:k.state._moreVisible,d[m?"hide":"show"](),k._setCorrectItemVisibility(k.state.startIndexB),k.config.justify){var n=m?j:i,o=Math.floor((f-l)/(n+(m?0:1)));for(b=0;e>b;b++)c[b].setClientWidth(o);m||d.setClientWidth(o)}if(a.css("visibility",""),k.state._focusedIndex>-1){var p=k.state._focusedIndex<=i;k.state._moreVisible=!p,k.config.delegateFocus&&k._data["list"+(p?"A":"B")][k.state._focusedIndex].focus()}k.dropdownCtrl[k.state._moreVisible?"open":"close"]()}},this._setCorrectItemVisibility=function(a){for(var b=0,c=k._data.listA.length;c>b;b++)-1===a||a>b?k._data.listB[b].hide():(k._data.listA[b].hide(),k._data.listB[b].show())},this._updateFocusedIndex=function(){k.state._focusedIndex=k._getFocusedIndexFromArrayList([k._data.listA,k._data.listB])},this._setFocusOn=function(a){switch(a){case"afterList":k._focusSkipLink(),k.state._focusedIndex=-1;break;case"lastA":k.state._focusedIndex=k.state.startIndexB-1,k._data.listA[k.state._focusedIndex].focus();break;case"firstB":k.state._focusedIndex=k.state.startIndexB,k._data.listB[k.state._focusedIndex].focus();break;case"self":k._updateFocusedIndex()}},this._getFocusedIndexFromArrayList=function(a){for(var b in a)for(var c in a[b])if(a[b][c].isActiveElement())return Number(c);return-1},this._focusSkipLink=function(){document.getElementById("splitListSkip-"+c.$id).focus()},this.addItem=function(a,b){k._data["list"+b.toUpperCase()].push(a)},this.addMoreBtn=function(a){k._data.moreBtn=a},this.handleFocus=function(a,b){if(k.config.delegateFocus)switch(a){case"toggle":k._setFocusOn(k.state._moreVisible?"lastA":"firstB");break;case"close":k._setFocusOn(b);break;case"self":k._setFocusOn("self")}},c.$on("mq-changed",function(a,b){0===b.width?angular.element(f).on("resize",k._splitList):angular.element(f).off("resize",k._splitList),k._splitList()}),c.$watch(function(){return k.dropdownCtrl&&k.dropdownCtrl.state.open},function(a){k.state._moreVisible=a}),e.on("keyup",i),e.on("keydown",j),c.$on("$destroy",function(){e.off("keyup",i),e.off("keydown",j),angular.element(f).off("resize",k._splitList)})}]}}]);